<!DOCTYPE html>
<html lang="en">
<head>

    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <link rel="stylesheet" type="text/css" href="../CSS/hermesStyle.css">

    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <script src="https://cdn.rawgit.com/eligrey/canvas-toBlob.js/f1a01896135ab378aa5c0118eadd81da55e698d8/canvas-toBlob.js"></script>
    <script src="https://cdn.rawgit.com/eligrey/FileSaver.js/e9d941381475b5df8b7d7691013401e171014e89/FileSaver.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">

    <script src="../Library/jquery.twbsPagination.min.js"></script>

</head>

<body onload="searchClicked(searchValue,typeValue)">

<div id="header1"></div>
<div id="overlay">
    <div class="loader"></div>
</div>

<div id="content">
    <table>
        <tr>
            <td >
                <div id="graphArea" class="startSize">
                    <div>
                        <table>
                            <tr>
                                <td width="50px" ><a href="#" title="Export data" onclick="downloadGraphAsData(); return false;"><span class="glyphicon glyphicon-save-file" id="exportData_glyphicons"></span></a></td>
                                <td width="50px"><a href="#" title="Download svg" onclick="downloadGraphAsSVG(); return false;"><span class="glyphicon glyphicon-download-alt" id="exportSVG_glyphicons"></span></a></td>
                                <td width="50px"><a href="#" title="Clear" onclick="clearSVG();return false;"><img src="../Images/clearicon.png" id="clearSVG"></a></td>
                                <td width="650px"></td>
                                <td width="250px"></td>
                                <td width="50px"><a href="#" title="" onclick=resize()><span class="glyphicon glyphicon-resize-full" id="enlarge_glyphicons"></span></a></td>
                            </tr>
                        </table>
                    </div>

                    <div>
                        <ul class="workspaceTab nav nav-tabs" role="tablist">
                            <li class="active" ><a href="#tabArea0" data-toggle="tab">Default tab <span>x</span></a>
                            </li>

                            <li><a href="#" class="add-tab">+</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane fade in active" id="tabArea0"></div>
                        </div>

                        <div >
                            <table class="slider">
                                <tr>
                                    <td style="width: 110px">Selected Year: </td>
                                       <!-- <p>Selected year:<p id="selectedyear" style="color:green"></p></p>-->
                                    <td style="width: 60px">
                                        <p id="selectedyear"></p>
                                    </td>
                                    <td>
                                        <form class="range-field" onclick=sliderMoved()>
                                            <input id="sliderValue" type="range" min="1940" max="2020" />
                                        </form>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </td>
            <td id="searchArea">
                <ul class="nav nav-tabs" id="resultList">
                    <li class="active"><a data-toggle="tab" href="#ResultsArea" onclick="loadResults()">Results</a></li>

                    <li class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#" >Facets <span class="caret"></span> </a>
                        <ul class="dropdown-menu">
                            <li><a  data-toggle="tab" href="#FacetsArea" onclick="loadFacets(searchValue,true)"> by year</a></li>
                            <li><a data-toggle="tab" href="#FacetsArea" onclick="loadFacets(searchValue,false)"> by citation count</a></li>
                        </ul>
                    </li>
                </ul>
                <div class="tab-content">

                    <div class="tab-pane fade in active searchsize" id="ResultsArea">
                        <table style="margin-left: 15px">
                            <tr>
                                <td>
                                    <p><b>Search Results for :</b> <p style="color:green"><b id="searchText"></b></b></p></p>
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <div class="list-group" id="list" style="width: 430px">
                                        <div id="tabContainer">
                                            <table  class="table-hover" id="resultTab" style="word-break: break-all;">
                                                <tbody id="searchResults">
                                                </tbody>
                                            </table>
                                        </div>
                                        <div id="pager">
                                            <ul id="pagination" class="pagination-sm"></ul>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>


                    <div id="FacetsArea" class="tab-pane fade">
                        <table  style="margin-left: 15px" class="table-hover table-bordered" id="facetTab" style="word-break: break-all;">
                            <tbody id="facetResults" >
                            </tbody>
                        </table>
                    </div>

                </div>
            </td>
        </tr>
    </table>
</div>



<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content" id="modalStyle">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Paper Details</h4>
            </div>
            <div class="modal-body">
                <table style="word-break: break-all;">
                    <tbody id="modalcontents" >

                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>


<div id="addTagModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-sm">
        <!-- Modal content-->
        <div class="modal-content" id="addTagstyle">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Add Tag</h4>
            </div>
            <div class="modal-body">
                <input type="text" id="modalInput" autofocus>
            </div>

            <div class="modal-footer">
                <button type="submit" id="btnAddTag" onclick="postTag">Add</button>
                <button type="submit" id="btnCancel" onclick="CloseAddTagWindow()">Cancel</button>
            </div>
        </div>
    </div>
</div>
<script src="../JS/HermesGraphLoader.js"></script>
<script src="../JS/Search.js"></script>
<script src="../JS/processAndFormEntities.js"></script>

<div id="footer1" class="footerClass"></div>
<script>

    var tabsClosedRecently=false;
    $(function () {
        $("#header1").load("Header.html");
        $("#footer1").load("Footer.html");
    });
    //to obtain the value that was entered in search field which was passed through url
    var url_string = window.location.href;
    var url = new URL(url_string);
    var searchValue = url.searchParams.get("value");
    var typeValue=url.searchParams.get("type");
    //alert("in schol type= "+typeValue)

    $(".workspaceTab").on("click", "a", function (e) {
        e.preventDefault();
        if (!$(this).hasClass('add-tab')) {
            $(this).tab('show');
        }
    })
        .on("click", "span", function () {
            var anchor = $(this).siblings('a');

            var indexofClosingTab=$(this).siblings("a")[0].getAttribute("href").substring(8,9);
            svg.splice(indexofClosingTab,1);
            force.splice(indexofClosingTab,1);
            authorAlreadyAdded.splice(indexofClosingTab,1);
            publicationAlreadyAdded.splice(indexofClosingTab,1);
            venueAlreadyAdded.splice(indexofClosingTab,1);
            coAuthorsAlreadyAdded.splice(indexofClosingTab,1);
            fosAlreadyAdded.splice(indexofClosingTab,1)
            instituteAlreadyAdded.splice(indexofClosingTab,1);
            processedArray.splice(indexofClosingTab,1);
            linksArray.splice(indexofClosingTab,1);

            tabsClosedRecently=true;
            $(anchor.attr('href')).remove();
            $(this).parent().remove();
            $(".workspaceTab li").children('a').first().click();


        });

    $('.add-tab').click(function (e) {
        e.preventDefault();
        var id = $(".workspaceTab").children().length-1;

        if(id>10){
            alert("Sorry!! you cannot add more then 10 tabs");
        }
        else{
            var tabId = 'paperGraphArea' + id;
            $(this).closest('li').before('<li><a data-toggle="tab" href="#tabArea' + id + '">New Tab</a> <span> x </span></li>');
            $('.tab-content').append('<div class="tab-pane fade" id=tabArea' + id + '></div>');

            var selector="#tabArea"+ id;
            if(!tabsClosedRecently) {
                svg[id] = d3.select(selector)
                    .append("svg")
                    .attr("id", tabId)
                    .attr("width", width)
                    .attr("height", height);

                force[id] = d3.layout.force()
                    .distance(100)
                    .linkDistance([150])
                    .charge(-500)
                    .size([1050, 620])
                    .gravity(0.1)
                    .alpha(0);
            }
            var ulItems=document.getElementsByClassName("workspaceTab");
            var liItems=ulItems[0].getElementsByTagName("li");
            var divElements=document.getElementsByClassName("tab-content");
            if(tabsClosedRecently){
                for(var i=0;i<liItems.length-1;i++){
                    var changedId="#tabArea"+i;
                    liItems[i].getElementsByTagName('a')[0].setAttribute("href",changedId);
                    divElements[0].getElementsByTagName("div")[i].setAttribute("id","tabArea"+i);
                }
                id = $(".workspaceTab").children().length-2;
                svg[id] = d3.select(selector)
                    .append("svg")
                    .attr("id", tabId)
                    .attr("width", width)
                    .attr("height", height);

                force[id] = d3.layout.force()
                    .distance(100)
                    .linkDistance([150])
                    .charge(-500)
                    .size([1050, 620])
                    .gravity(0.1)
                    .alpha(0);

                for(var j=0;j<divElements[0].getElementsByTagName("div").length;j++){
                    divElements[0].getElementsByTagName("div")[j].getElementsByTagName("svg")[0].setAttribute("id","paperGraphArea"+j);
                }
                //id = $(".workspaceTab").children().length-2;
                tabsClosedRecently=false;
            }

            $('.workspaceTab li:nth-child(' + id + ') a').click();
            authorAlreadyAdded[id]=new Map();
            publicationAlreadyAdded[id]=new Map();
            venueAlreadyAdded[id]=new Map();
            coAuthorsAlreadyAdded[id]=new Map();
            fosAlreadyAdded[id]=new Map();
            instituteAlreadyAdded[id]=new Map();

            processedArray[id]=[];
            linksArray[id]=[];
        }
    });


</script>
</body>
</html>